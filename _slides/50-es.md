# Event Sourcing

-----
# What is an Event ?
## an Event : 
- Reprensentes a state change of the system
- Very carefully named in passed tense
  * Ubiquitous language
  * Donâ€™t be CRUDy
  * Event != Entity 
- Is imutable !
???
Do you a favor : Keep it's structure as simple as you can, you'll have to manage versioning on Events.
- ...

.footnote[
https://blog.arkency.com/2016/05/the-anatomy-of-domain-event/
]


-----
# Aggregates & Streams
<img src="../_assets/FreshPaint-21-2014.01.04-10.55.10.png" title="Event Sourcing" width="480em" style="float:right"/>
## An Aggregate
- Is the business Entity
- has a state
- handle a Command
- produce/emit 0-N Events
- apply those events <br/> to its state
- live in memory, no persistence needed

-----
## A Stream
- Store all events for **1 aggregate**


.footnote[
https://thinkbeforecoding.com/post/2014/01/04/Event-Sourcing.-Draw-it
]
???
The handle/decide method:
- can decide to do nothing
- can decide to return an error
- Should never-ever-ever mutate the state !

The apply method:
- Will be called to hydrade the aggregate on the next command handle
- Should never-ever-ever fail !



-----
# Event Store
## the source of all truth
- has a very simple schema : [StreamId, EventNumber, EventName, EventPayload]
- can be append only, **no update or delete** required


- Store events **in order** for each streams
- Guarantees transaction on a single stream
- Is fast to query on a single stream,
  * in **EventNumber** ascending order,
  * and from a given position/EventNumber.

<img src="../_assets/eventstore-logo.png" title="EventStore logo"  style="float:right"/>
- should be able to give an aggregated log of all streams 
- great if you can re-partition streams according to projections needs
.footnote[https://eventstore.org/]


-----
# Projections



-----
# Can go wrong ?
<img src="../_assets/2hardproblems.png" title="2 hard problems in distributed systems"  style="float:center"/>




----- 
## Should you do C.Q.R.S.

----- 
## Should you do Event Sourcing